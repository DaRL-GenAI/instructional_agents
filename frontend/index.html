<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="pageTitle">Instructional Agents - 课程生成系统</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="language-toggle-container">
        <button type="button" id="language-toggle" class="btn btn-secondary">
            🇨🇳 中文
        </button>
    </div>
    <!-- Hero 区域 -->
    <div class="hero">
        <div class="hero-content">
            <h1 data-i18n="heroTitle" data-i18n-target="text">🎓 Instructional Agents</h1>
            <p class="subtitle" data-i18n="heroSubtitle" data-i18n-target="html">AI驱动的课程材料自动生成系统<br>让教学准备变得简单高效</p>
        </div>
    </div>

    <div class="container">
        <main>
            <!-- API Key Configuration -->
            <section id="api-key-section" class="card">
                <h2 data-i18n="apiSectionTitle">API 配置</h2>
                <div class="form-group">
                    <label for="api-key" data-i18n="apiKeyLabel">OpenAI API Key *</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="password" id="api-key" name="api_key" required 
                               placeholder="sk-..." style="flex: 1;" data-i18n-placeholder="apiKeyPlaceholder">
                        <button type="button" id="toggle-api-key" class="btn btn-secondary" style="width: auto; padding: 12px 20px; min-width: 100px;" data-i18n="apiKeyToggleShow">
                            👁️ 显示
                        </button>
                    </div>
                    <small data-i18n="apiKeyNote">您的 API Key 仅保存在浏览器本地，不会上传到服务器</small>
                </div>
                <button type="button" id="save-api-key" class="btn btn-primary" data-i18n="saveApiKeyButton" data-i18n-target="html">
                    <span>💾</span>
                    <span>保存 API Key</span>
                </button>
            </section>

            <!-- Configuration Form -->
            <section id="config-section" class="card">
                <h2 data-i18n="configSectionTitle">课程配置</h2>
                <form id="course-form">
                    <div class="form-group">
                        <label for="course-name" data-i18n="courseNameLabel">课程名称 *</label>
                        <input type="text" id="course-name" name="course_name" required 
                               placeholder="例如：机器学习导论" data-i18n-placeholder="courseNamePlaceholder">
                    </div>

                    <div class="form-group">
                        <label for="model-name" data-i18n="modelNameLabel">模型选择</label>
                        <select id="model-name" name="model_name">
                            <option value="gpt-4o-mini" selected data-i18n="modelOptionMini">GPT-4o Mini (推荐)</option>
                            <option value="gpt-4o" data-i18n="modelOptionGpt4o">GPT-4o</option>
                            <option value="gpt-4-turbo" data-i18n="modelOptionGpt4Turbo">GPT-4 Turbo</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="exp-name" data-i18n="expNameLabel">实验名称</label>
                        <input type="text" id="exp-name" name="exp_name" 
                               placeholder="默认：default" value="default" data-i18n-placeholder="expNamePlaceholder">
                    </div>

                    <div class="form-group checkbox-group">
                        <label>
                            <input type="checkbox" id="copilot-mode" name="copilot">
                            <span data-i18n="copilotLabel">启用 Copilot 模式（交互式反馈）</span>
                        </label>
                    </div>

                    <div class="form-group">
                        <label for="catalog-mode" data-i18n="catalogModeLabel">Catalog 模式</label>
                        <select id="catalog-mode" name="catalog_mode">
                            <option value="none" data-i18n="catalogOptionNone">不使用</option>
                            <option value="default" data-i18n="catalogOptionDefault">使用默认 Catalog</option>
                            <option value="upload" data-i18n="catalogOptionUpload">上传 Catalog 文件</option>
                            <option value="select" data-i18n="catalogOptionSelect">选择已有 Catalog</option>
                        </select>
                    </div>

                    <div class="form-group" id="catalog-upload-group" style="display: none;">
                        <label for="catalog-file" data-i18n="catalogUploadLabel">上传 Catalog JSON 文件</label>
                        <input type="file" id="catalog-file" accept=".json">
                        <small data-i18n="catalogUploadTip">或直接在下方输入 JSON 数据</small>
                    </div>

                    <div class="form-group" id="catalog-select-group" style="display: none;">
                        <label for="catalog-select" data-i18n="catalogSelectLabel">选择 Catalog</label>
                        <select id="catalog-select" data-i18n-placeholder="catalogSelectPlaceholder">
                            <option value="" data-i18n="catalogSelectLoading">加载中...</option>
                        </select>
                    </div>

                    <div class="form-group" id="catalog-json-group" style="display: none;">
                        <label for="catalog-json" data-i18n="catalogJsonLabel">Catalog JSON 数据</label>
                        <textarea id="catalog-json" rows="10" 
                                  placeholder='{"student_profile": {...}, "instructor_preferences": {...}}' data-i18n-placeholder="catalogJsonPlaceholder"></textarea>
                    </div>

                    <button type="submit" id="submit-btn" class="btn btn-primary" data-i18n="submitButtonText" data-i18n-target="html">
                        <span>🚀</span>
                        <span>开始生成课程</span>
                    </button>
                </form>
            </section>

            <!-- Progress Section -->
            <section id="progress-section" class="card" style="display: none;">
                <h2 data-i18n="progressSectionTitle">生成进度</h2>
                <div id="progress-info">
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progress-bar"></div>
                    </div>
                    <p id="progress-text" data-i18n="progressInitial">初始化中...</p>
                    <p id="current-stage" class="stage-text"></p>
                </div>
                <div id="error-message" class="error-message" style="display: none;"></div>
                
                <!-- Real-time Logs -->
                <div id="logs-section" style="margin-top: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <h3 style="margin: 0;" data-i18n="logsTitle">实时日志</h3>
                        <button type="button" id="clear-logs-btn" class="btn btn-secondary" style="width: auto; padding: 8px 16px; font-size: 0.875rem; min-width: 100px;" data-i18n="clearLogsButton" data-i18n-target="text">
                            🗑️ 清空日志
                        </button>
                    </div>
                    <div id="logs-container" class="logs-container">
                        <p class="logs-placeholder" data-i18n="logsPlaceholder">等待日志输出...</p>
                    </div>
                </div>
            </section>

            <!-- Slide Optimization Section -->
            <section id="slide-optimization-section" class="card">
                <h2 data-i18n="slideOptimizationTitle">📚 幻灯片优化</h2>
                <p class="section-description" data-i18n="slideOptimizationDescription">上传您的PDF幻灯片，系统将分析内容并提供改进建议</p>
                
                <form id="slide-optimization-form">
                    <div class="form-group">
                        <label for="slide-pdf-files" data-i18n="slidePdfFilesLabel">上传PDF幻灯片文件 *</label>
                        <input type="file" id="slide-pdf-files" accept=".pdf" multiple>
                        <small data-i18n="slidePdfFilesTip">可以选择多个PDF文件（支持Ctrl/Cmd+点击多选）</small>
                        <div id="slide-files-list" style="margin-top: 10px;"></div>
                    </div>

                    <div id="slide-upload-status" style="display: none; margin: 15px 0;">
                        <div class="upload-status-message"></div>
                    </div>

                    <div class="form-group">
                        <label for="optimization-mode" data-i18n="optimizationModeLabel">优化模式</label>
                        <select id="optimization-mode" name="optimization_mode">
                            <option value="chapter" selected data-i18n="optimizationModeChapter">优化指定章节</option>
                            <option value="all" data-i18n="optimizationModeAll">优化全部课程</option>
                        </select>
                    </div>

                    <div class="form-group" id="chapter-name-group">
                        <label for="chapter-name" data-i18n="chapterNameLabel">章节名称</label>
                        <input type="text" id="chapter-name" name="chapter_name" 
                               placeholder="例如：Chapter 3 或 第3章" data-i18n-placeholder="chapterNamePlaceholder">
                        <small data-i18n="chapterNameTip">支持格式：Chapter 1, Chapter1, Ch1, 第1章 等</small>
                    </div>

                    <div class="form-group">
                        <label for="user-requirements" data-i18n="userRequirementsLabel">优化需求描述 *</label>
                        <textarea id="user-requirements" name="user_requirements" rows="4" required
                                  placeholder="例如：添加更多实例、改进解释、增加代码示例等" data-i18n-placeholder="userRequirementsPlaceholder"></textarea>
                    </div>

                    <button type="submit" id="optimize-slides-btn" class="btn btn-primary" data-i18n="optimizeSlidesButton" data-i18n-target="html">
                        <span>🔍</span>
                        <span>开始分析优化</span>
                    </button>
                </form>

                <!-- Optimization Results -->
                <div id="optimization-results" style="display: none; margin-top: 30px;">
                    <h3 data-i18n="optimizationResultsTitle">分析结果</h3>
                    <div id="optimization-results-content">
                        <p data-i18n="optimizationResultsLoading">分析中...</p>
                    </div>
                    
                    <!-- Generate Enhanced Slides Button -->
                    <div id="generate-latex-section" style="display: none; margin-top: 20px; padding: 20px; background: #f0f9ff; border-radius: 5px;">
                        <h4 data-i18n="generateLatexTitle">生成改进后的幻灯片</h4>
                        <p data-i18n="generateLatexDescription">基于分析结果和改进建议，生成改进后的LaTeX幻灯片文件</p>
                        
                        <!-- User Feedback Input -->
                        <div id="latex-feedback-section" style="margin: 15px 0; display: none;">
                            <h5 data-i18n="feedbackTitle">提供反馈（可选）</h5>
                            <label for="latex-feedback-slides" style="display: block; margin: 10px 0 5px 0; font-weight: bold;">
                                <span data-i18n="feedbackSlidesLabel">对幻灯片的反馈:</span>
                            </label>
                            <textarea 
                                id="latex-feedback-slides" 
                                rows="3" 
                                style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: inherit;"
                                placeholder="例如：需要更多示例、调整内容顺序等..."
                            ></textarea>
                            
                            <label for="latex-feedback-overall" style="display: block; margin: 10px 0 5px 0; font-weight: bold;">
                                <span data-i18n="feedbackOverallLabel">总体反馈:</span>
                            </label>
                            <textarea 
                                id="latex-feedback-overall" 
                                rows="3" 
                                style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: inherit;"
                                placeholder="例如：整体风格、内容深度等..."
                            ></textarea>
                        </div>
                        
                        <button type="button" id="generate-latex-btn" class="btn btn-primary" data-i18n="generateLatexButton" data-i18n-target="html">
                            <span>📝</span>
                            <span>生成LaTeX文件</span>
                        </button>
                        
                        <button type="button" id="toggle-feedback-btn" class="btn btn-secondary" style="margin-left: 10px;">
                            <span>💬</span>
                            <span data-i18n="toggleFeedbackButton">添加反馈</span>
                        </button>
                        
                        <div id="latex-generation-status" style="margin-top: 15px; display: none;"></div>
                        <div id="latex-download-links" style="margin-top: 15px; display: none;"></div>
                        
                        <!-- Iterative Improvement Section -->
                        <div id="latex-improve-section" style="display: none; margin-top: 20px; padding: 15px; background: #fff9e6; border-radius: 5px; border: 1px solid #ffd700;">
                            <h5 data-i18n="improveTitle">迭代改进</h5>
                            <p data-i18n="improveDescription">基于生成的幻灯片提供反馈，系统将重新生成改进版本</p>
                            <button type="button" id="improve-latex-btn" class="btn btn-warning">
                                <span>🔄</span>
                                <span data-i18n="improveButton">基于反馈重新生成</span>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Results Section -->
            <section id="results-section" class="card" style="display: none;">
                <h2 data-i18n="resultsSectionTitle">生成结果</h2>
                <div id="results-content">
                    <p data-i18n="resultsLoading">加载文件列表...</p>
                </div>
            </section>
        </main>

        <footer>
            <p style="opacity: 0.7;" data-i18n="footerText">Powered by <strong>Instructional Agents</strong> • AI-Powered Course Generation</p>
        </footer>
    </div>

    <script src="app.js"></script>
</body>
</html>

